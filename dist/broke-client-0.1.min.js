var broke={},bk=broke;
(function(){broke.extend=function(){var name,target=arguments[0]||{},i=1,length=arguments.length,deep=false,options,src,copy;if(arguments.length>2)broke.extend.apply(broke,arguments.slice(1));if(typeof target==="boolean"){deep=target;target=arguments[1]||{};i=2}if(typeof target!=="object"&&!(target instanceof Function))target={};if(length==i){target=this;--i}while(i<length){if((options=arguments[i])!==null)for(name in options)if(options.hasOwnProperty(name)){src=target[name];copy=options[name];if(target===
copy)continue;if(deep&&copy&&typeof copy==="object"&&!copy.nodeType)target[name]=broke.extend(deep,src||(copy.length!==null?[]:{}),copy);else if(copy!==undefined)target[name]=copy}i++}return target};var privateAttrs={bindEvents:function(){var callback;if(broke.settings.eventTriggeringMethod==="elements"){callback=function(e){var _this=$(this),tag=this.tagName.lower(),urlChangingElement=broke.settings.urlChangingElements[tag],urlAttribute=urlChangingElement.urlAttribute,url=_this.attr(urlAttribute);
if(urlChangingElement.preventDefault)e.preventDefault();if(url!==undefined&&url.contains("#"))broke.request({event:e,url:url.split("#")[1],completeUrl:url})};forEach(broke.settings.urlChangingElements,function(key){$(key)[broke.settings.eventBinding](this.events.join(","),callback)})}else if(broke.settings.eventTriggeringMethod==="hashchange"){if(!("onhashchange"in window))(function(){var oldHash=location.hash;setInterval(function(){if(location.hash!==oldHash){oldHash=location.hash;$(window).trigger("hashchange")}},
150)})();window.onhashchange=function(e){broke.request({event:e,url:location.href.split("#")[1]})}}},searchNamedUrls:function(){var callback=function(urlChangingElement){var _this=$(this),urlAttribute=urlChangingElement.urlAttribute,urlToRender=_this.attr(urlAttribute),namedUrl,args,result;if(urlToRender.contains("<#")){urlToRender=urlToRender.replace("<#","").replace("#>","").trim().split(" ");namedUrl=urlToRender[0];args=urlToRender[1];if(args)args=args.split(",");else args=[];result=broke.urlResolvers.reverse(namedUrl,
args);_this.attr(urlAttribute,"#"+result)}};forEach(broke.settings.urlChangingElements,function(key){var elements=$(key),elementsLength=elements.length;while(elementsLength--)callback.call(elements[elementsLength],this)})},getLanguageFiles:function(){var languageCode=broke.settings.languageCode,localePath="/locale/%s/LC_MESSAGES/broke.po".echo(languageCode),localePaths=[broke.settings.baseUrl+"/conf"];broke.projects.each(function(){localePaths.populate(this.settings.localePaths)});localePaths.each(function(){brokebroke.utils.translation.gettext.init({url:this+
localePath})});return}};broke.extend({VERSION:"0.1b",isReady:false,init:function(){$(document).ready(function(){broke.projects.each(function(){broke.initProject(this)});if(broke.settings.usei18n)privateAttrs.getLanguageFiles();privateAttrs.searchNamedUrls();privateAttrs.bindEvents();if(window.location.hash!=="")broke.request(window.location.hash.split("#")[1]);$(window).trigger("broke.ready");broke.isReady=true})},request:function(args){var req={};if(typeOf(args)==="string")req.url=args;else req=
args;$(window).trigger("broke.request",[req])},response:function(args){$(window).trigger("broke.request",[args])},removeHash:function(){window.location.hash="";return true},log:function(debugString,doNotAppendDate){if(broke.settings.debug&&window.console){if(!doNotAppendDate){var now=new Date;now=now.getHours()+":"+now.getMinutes()+":"+now.getSeconds()+":"+now.getMilliseconds();debugString="["+now+"] "+debugString}console.debug(debugString)}},fetchData:function(args){var model=args.model,url=args.url||
broke.settings.jsonUrls.getData.interpolate({appLabel:model.appLabel,model:model.className.lower()}),filter=args.filter||{},result;$.ajax({async:false,type:"GET",url:url,data:filter,dataType:broke.settings.ajax.dataType,error:function(xhr,status,error){result=error},success:function(data,status){broke.storage[model.tableName]=data;result=broke.storage[model.tableName]}});return result},initStorage:function(model){broke.fetchData({model:model})},initProject:function(project){var key,subKey;for(key in project.models)if(project.models.hasOwnProperty(key))broke.initStorage(project.models[key]);
broke.extend(broke.urlPatterns,project.urlPatterns);for(key in project.apps)if(project.apps.hasOwnProperty(key))for(subKey in project.apps[key].models)if(project.apps[key].models.hasOwnProperty(subKey))broke.initStorage(project.apps[key].models[subKey]);return project},registerProject:function(project){broke.extend(broke.settings,project.settings);this.projects.push(project);return project},projects:[],storage:{},db:{models:{}},exceptions:{},shortcuts:{},i18n:{},locale:{},urlPatterns:[],views:{},
template:{},templates:{},middleware:{},contextProcessors:{}});broke.init()})();
broke.extend({settings:{ajax:{dataType:"json",async:false},eventTriggeringMethod:"elements",baseUrl:"/broke",debug:false,contextProcessors:["broke.contextProcessors.debug"],dateFormat:"%Y/%m/%d",eventBinding:"live",form:null,getLatestBy:"id",handler404:"broke.views.pageNotFound",installedApps:[],jsonUrls:{getData:"/%(appLabel)s/%(model)s/json/get_data/",save:"/%(appLabel)s/%(model)s/json/save/","delete":"/%(appLabel)s/%(model)s/json/delete/"},localePaths:[],languageCode:"en",languages:{en:"English",
it:"Italian"},languageCookieName:"broke_language",middleware:["broke.middleware.CommonMiddleware"],preventDefault:false,queryType:"local","return":window.location.href,stopPropagation:false,save:{commit:true},templateStringIfInvalid:"",templateDirs:[],templateLoaders:["broke.template.loaders.projects"],urlChangingElements:{a:{events:["click"],urlAttribute:"href"},form:{events:["submit"],urlAttribute:"action",preventDefault:true},"div[data-href]":{events:["div"],urlAttribute:"data-href"},"*[data-href]":{events:["click"],
urlAttribute:"data-href"}},useAjax:true,usei18n:false}});
(function(){var initializing=false,fnTest=/xyz/.test(function(){var xyz})?/\b_super\b/:/.*/,callback=function(f_names){var args=[].populate(arguments),self;f_names=args.shift();if(!isArray(f_names))f_names=[f_names];self=this;return function(){var cur=args.concat([].populate(arguments)),f,isString;for(f=0;f<f_names.length;f++){if(!f_names[f])continue;isString=typeof f_names[f]=="string";if(isString&&self._set_called)self.called=f_names[f];cur=(isString?self[f_names[f]]:f_names[f]).apply(self,cur);
if(!cur)cur=[];else if(!isArray(cur)||cur._use_call)cur=[cur]}return cur}};broke.Class=function(){};broke.Class.callback=callback;broke.Class.extend=function(className,klass,proto){var _super_class,_super,prototype,name,i;if(typeof className!="string"){proto=klass;klass=className;className=null}if(!proto){proto=klass;klass=null}proto=proto||{};_super_class=this;_super=this.prototype;initializing=true;prototype=new this;initializing=false;for(name in proto)prototype[name]=typeof proto[name]=="function"&&
typeof _super[name]=="function"&&fnTest.test(proto[name])?function(name,fn){return function(){var tmp=this._super,ret;this._super=_super[name];ret=fn.apply(this,arguments);this._super=tmp;return ret}}(name,proto[name]):proto[name];function Class(){if(!initializing&&this.init)this.init.apply(this,arguments)}Class.prototype=prototype;Class.prototype.Class=Class;Class.constructor=Class;for(name in this)if(this.hasOwnProperty(name)&&name!="prototype")Class[name]=this[name];for(name in klass)Class[name]=
typeof klass[name]=="function"&&typeof Class[name]=="function"&&fnTest.test(klass[name])?function(name,fn){return function(){var tmp=this._super,ret;this._super=_super_class[name];ret=fn.apply(this,arguments);this._super=tmp;return ret}}(name,klass[name]):klass[name];Class.newInstance=function(){var inst=new Class;initializing=true;initializing=false;if(inst.init)inst.init.apply(inst,arguments);return inst};Class.extend=arguments.callee;if(className){var current=window,parts=className.split(/\./);
for(i=0;i<parts.length-1;i++)current=current[parts[i]]||(current[parts[i]]={});current[parts[parts.length-1]]=Class;Class.className=parts[parts.length-1];Class.fullName=className}if(Class.init)Class.init(Class);if(_super_class.extended)_super_class.extended(Class);return Class};broke.Class.prototype={callback:callback}})();
(function(){broke.extend(broke.exceptions,{NotFound:function(message){return{name:"NotFound",message:message}},NotImplemented:function(message){return{name:"NotImplemented",message:message}},MultipleObjectsReturned:function(message){return{name:"MultipleObjectsReturned",message:message}},DoesNotExist:function(message){return{name:"DoesNotExist",message:message}},TemplateSyntaxError:function(message){return{name:"TemplateSyntaxError",message:message}},TemplateDoesNotExist:function(message){return{name:"TemplateSyntaxError",
message:message}},TemplateEncodingError:function(message){return{name:"TemplateSyntaxError",message:message}},VariableDoesNotExist:function(message){return{name:"TemplateSyntaxError",message:message}}})})();
(function(){var contextGlue="\u0004",_localeData={},domain="messages",localeData,url="",tryLoadLang=function(){var localeCopy,langLink,i,link;if(typeof localeData!="undefined"){localeCopy=localeData;localeData=undefined;parseLocaleData(localeCopy);if(typeof _localeData[domain]=="undefined")throw new Error("Error: Gettext 'localeData' does not contain the domain '"+domain+"'");}langLink=getLangRefs();if(typeof langLink=="object"&&langLink.length>0)for(i=0;i<langLink.length;i++){link=langLink[i];if(link.type==
"application/json"){if(!tryLoadLangJson(link.href))throw new Error("Error: Gettext 'tryLoadLangJson' failed. Unable to exec xmlhttprequest for link ["+link.href+"]");}else if(link.type=="application/x-po"){if(!tryLoadLangPo(link.href))throw new Error("Error: Gettext 'tryLoadLangPo' failed. Unable to exec xmlhttprequest for link ["+link.href+"]");}else throw new Error("TODO: link type ["+link.type+"] found, and support is planned, but not implemented at this time.");}},parseLocaleData=function(localeData){var domain,
has_msgids,msgid,data,key,header,head,h;if(typeof _localeData=="undefined")_localeData={};for(domain in localeData){if(!localeData.hasOwnProperty(domain)||!isValidObject(localeData[domain]))continue;has_msgids=false;for(msgid in localeData[domain]){has_msgids=true;break}if(!has_msgids)continue;data=localeData[domain];if(domain=="")domain="messages";if(!isValidObject(_localeData[domain]))_localeData[domain]={};if(!isValidObject(_localeData[domain].head))_localeData[domain].head={};if(!isValidObject(_localeData[domain].msgs))_localeData[domain].msgs=
{};for(key in data)if(key==""){header=data[key];for(head in header){h=head.toLowerCase();_localeData[domain].head[h]=header[head]}}else _localeData[domain].msgs[key]=data[key]}for(domain in _localeData){var plural_forms,pf_re,pf,code,p;if(isValidObject(_localeData[domain].head["plural-forms"])&&typeof _localeData[domain].head.plural_func=="undefined"){plural_forms=_localeData[domain].head["plural-forms"];pf_re=new RegExp("^(\\s*nplurals\\s*=\\s*[0-9]+\\s*;\\s*plural\\s*=\\s*(?:\\s|[-\\?\\|&=!<>+*/%:;a-zA-Z0-9_()])+)",
"m");if(pf_re.test(plural_forms)){pf=_localeData[domain].head["plural-forms"];if(!/;\s*$/.test(pf))pf=pf.concat(";");code="var plural; var nplurals; "+pf+' return { "nplural" : nplurals, "plural" : (plural === true ? 1 : plural ? plural : 0) };';_localeData[domain].head.plural_func=new Function("n",code)}else throw new Error("Syntax error in language file. Plural-Forms header is invalid ["+plural_forms+"]");}else if(typeof _localeData[domain].head.plural_func=="undefined")_localeData[domain].head.plural_func=
function(n){p=n!=1?1:0;return{nplural:2,plural:p}}}return},tryLoadLangPo=function(uri){var data=sjax(uri),domain,parsed,rv;if(!data)return;domain=uriBasename(uri);parsed=parsePo(data);rv={};if(parsed){if(!parsed[""])parsed[""]={};if(!parsed[""].domain)parsed[""].domain=domain;domain=parsed[""].domain;rv[domain]=parsed;parseLocaleData(rv)}return 1},parsePo=function(data){var rv={},buffer={},lastbuffer="",errors=[],lines=data.split("\n"),i,match,msg_ctxt_id,msgid_plural,trans,str,cur,hlines,pos,key,
val,keylow;for(i=0;i<lines.length;i++){lines[i]=lines[i].replace(/(\n|\r)+$/,"");if(/^$/.test(lines[i])){if(typeof buffer.msgid!="undefined"){msg_ctxt_id=typeof buffer.msgctxt!="undefined"&&buffer.msgctxt.length?buffer.msgctxt+contextGlue+buffer.msgid:buffer.msgid;msgid_plural=typeof buffer.msgid_plural!="undefined"&&buffer.msgid_plural.length?buffer.msgid_plural:null;trans=[];for(str in buffer){match=str.match(/^msgstr_(\d+)/);if(match)trans[parseInt(match[1],10)]=buffer[str]}trans.unshift(msgid_plural);
if(trans.length>1)rv[msg_ctxt_id]=trans;buffer={};lastbuffer=""}}else if(/^#/.test(lines[i]))continue;else if(match=lines[i].match(/^msgctxt\s+(.*)/)){lastbuffer="msgctxt";buffer[lastbuffer]=parsePoDequote(match[1])}else if(match=lines[i].match(/^msgid\s+(.*)/)){lastbuffer="msgid";buffer[lastbuffer]=parsePoDequote(match[1])}else if(match=lines[i].match(/^msgid_plural\s+(.*)/)){lastbuffer="msgid_plural";buffer[lastbuffer]=parsePoDequote(match[1])}else if(match=lines[i].match(/^msgstr\s+(.*)/)){lastbuffer=
"msgstr_0";buffer[lastbuffer]=parsePoDequote(match[1])}else if(match=lines[i].match(/^msgstr\[0\]\s+(.*)/)){lastbuffer="msgstr_0";buffer[lastbuffer]=parsePoDequote(match[1])}else if(match=lines[i].match(/^msgstr\[(\d+)\]\s+(.*)/)){lastbuffer="msgstr_"+match[1];buffer[lastbuffer]=parsePoDequote(match[2])}else if(/^"/.test(lines[i]))buffer[lastbuffer]+=parsePoDequote(lines[i]);else errors.push("Strange line ["+i+"] : "+lines[i])}if(typeof buffer.msgid!="undefined"){msg_ctxt_id=typeof buffer.msgctxt!=
"undefined"&&buffer.msgctxt.length?buffer.msgctxt+contextGlue+buffer.msgid:buffer.msgid;msgid_plural=typeof buffer.msgid_plural!="undefined"&&buffer.msgid_plural.length?buffer.msgid_plural:null;trans=[];for(str in buffer)if(match=str.match(/^msgstr_(\d+)/))trans[parseInt(match[1],10)]=buffer[str];trans.unshift(msgid_plural);if(trans.length>1)rv[msg_ctxt_id]=trans;buffer={};lastbuffer=""}if(rv[""]&&rv[""][1]){cur={};hlines=rv[""][1].split(/\\n/);for(i=0;i<hlines.length;i++){if(!hlines.length)continue;
pos=hlines[i].indexOf(":",0);if(pos!=-1){key=hlines[i].substring(0,pos);val=hlines[i].substring(pos+1);keylow=key.toLowerCase();if(cur[keylow]&&cur[keylow].length)errors.push("SKIPPING DUPLICATE HEADER LINE: "+hlines[i]);else if(/#-#-#-#-#/.test(keylow))errors.push("SKIPPING ERROR MARKER IN HEADER: "+hlines[i]);else{val=val.replace(/^\s+/,"");cur[keylow]=val}}else{errors.push("PROBLEM LINE IN HEADER: "+hlines[i]);cur[hlines[i]]=""}}rv[""]=cur}else rv[""]={};return rv},uriBasename=function(uri){var rv,
ext_strip;if(rv=uri.match(/^(.*\/)?(.*)/))if(ext_strip=rv[2].match(/^(.*)\..+$/))return ext_strip[1];else return rv[2];else return""},parsePoDequote=function(str){var match;if(match=str.match(/^"(.*)"/))str=match[1];str=str.replace(/\\"/,"");return str},tryLoadLangJson=function(uri){var data=sjax(uri),rv;if(!data)return;rv=JSON(data);parseLocaleData(rv);return 1},getLangRefs=function(){var langs=[],links=document.getElementsByTagName("link"),i;for(i=0;i<links.length;i++)if(links[i].rel=="gettext"&&
links[i].href){if(typeof links[i].type=="undefined"||links[i].type=="")if(/\.json$/i.test(links[i].href))links[i].type="application/json";else if(/\.js$/i.test(links[i].href))links[i].type="application/json";else if(/\.po$/i.test(links[i].href))links[i].type="application/x-po";else if(/\.mo$/i.test(links[i].href))links[i].type="application/x-mo";else throw new Error("LINK tag with rel=gettext found, but the type and extension are unrecognized.");links[i].type=links[i].type.toLowerCase();if(links[i].type==
"application/json")links[i].type="application/json";else if(links[i].type=="text/javascript")links[i].type="application/json";else if(links[i].type=="application/x-po")links[i].type="application/x-po";else if(links[i].type=="application/x-mo")links[i].type="application/x-mo";else throw new Error("LINK tag with rel=gettext found, but the type attribute ["+links[i].type+"] is unrecognized.");langs.push(links[i])}return langs},textdomain=function(domain){if(domain&&domain.length)domain=domain;return domain},
gettext=function(msgid){var msgctxt,msgid_plural,n,category;return dcnpgettext(null,msgctxt,msgid,msgid_plural,n,category)},dgettext=function(domain,msgid){var msgctxt,msgid_plural,n,category;return dcnpgettext(domain,msgctxt,msgid,msgid_plural,n,category)},dcgettext=function(domain,msgid,category){var msgctxt,msgid_plural,n;return dcnpgettext(domain,msgctxt,msgid,msgid_plural,n,category)},ngettext=function(msgid,msgid_plural,n){var msgctxt,category;return dcnpgettext(null,msgctxt,msgid,msgid_plural,
n,category)},dngettext=function(domain,msgid,msgid_plural,n){var msgctxt,category;return dcnpgettext(domain,msgctxt,msgid,msgid_plural,n,category)},dcngettext=function(domain,msgid,msgid_plural,n,category){var msgctxt;return dcnpgettext(domain,msgctxt,msgid,msgid_plural,n,category,category)},pgettext=function(msgctxt,msgid){var msgid_plural,n,category;return dcnpgettext(null,msgctxt,msgid,msgid_plural,n,category)},dpgettext=function(domain,msgctxt,msgid){var msgid_plural,n,category;return dcnpgettext(domain,
msgctxt,msgid,msgid_plural,n,category)},dcpgettext=function(domain,msgctxt,msgid,category){var msgid_plural,n;return dcnpgettext(domain,msgctxt,msgid,msgid_plural,n,category)},npgettext=function(msgctxt,msgid,msgid_plural,n){var category;return dcnpgettext(null,msgctxt,msgid,msgid_plural,n,category)},dnpgettext=function(domain,msgctxt,msgid,msgid_plural,n){var category;return dcnpgettext(domain,msgctxt,msgid,msgid_plural,n,category)},dcnpgettext=function(domain,msgctxt,msgid,msgid_plural,n,category){if(!isValidObject(msgid))return"";
var plural=isValidObject(msgid_plural),msg_ctxt_id=isValidObject(msgctxt)?msgctxt+contextGlue+msgid:msgid,domainname=isValidObject(domain)?domain:isValidObject(domain)?domain:"messages";var category_name="LC_MESSAGES",localeData=[],dom;category=5;if(typeof _localeData!="undefined"&&isValidObject(_localeData[domainname]))localeData.push(_localeData[domainname]);else if(typeof _localeData!="undefined")for(dom in _localeData)localeData.push(_localeData[dom]);var trans=[],found=false,domain_used,i,j,
translation,locale,p,rv;if(localeData.length)for(i=0;i<localeData.length;i++){locale=localeData[i];if(isValidObject(locale.msgs[msg_ctxt_id])){for(j=0;j<locale.msgs[msg_ctxt_id].length;j++)trans[j]=locale.msgs[msg_ctxt_id][j];trans.shift();domain_used=locale;found=true;break}}if(!trans.length)trans=[msgid,msgid_plural];translation=trans[0];if(plural){if(found&&isValidObject(domain_used.head.plural_func)){rv=domain_used.head.plural_func(n);if(!rv.plural)rv.plural=0;if(!rv.nplural)rv.nplural=0;if(rv.nplural<=
rv.plural)rv.plural=0;p=rv.plural}else p=n!=1?1:0;if(isValidObject(trans[p]))translation=trans[p]}return translation},strargs=function(str,args){if(null===args||"undefined"===typeof args)args=[];else if(args.constructor!=Array)args=[args];var newstr="",i,match_n,arg_n,length_n;while(true){i=str.indexOf("%");if(i==-1){newstr+=str;break}newstr+=str.substr(0,i);if(str.substr(i,2)=="%%"){newstr+="%";str=str.substr(i+2)}else if(match_n=str.substr(i).match(/^%(\d+)/)){arg_n=parseInt(match_n[1],10);length_n=
match_n[1].length;if(arg_n>0&&args[arg_n-1]!=null&&typeof args[arg_n-1]!="undefined")newstr+=args[arg_n-1];str=str.substr(i+1+length_n)}else{newstr+="%";str=str.substr(i+1)}}return newstr},isArray=function(thisObject){return isValidObject(thisObject)&&thisObject.constructor==Array},isValidObject=function(thisObject){if(null==thisObject)return false;else if("undefined"==typeof thisObject)return false;else return true},sjax=function(uri){var data=null;$.ajax({async:false,url:uri,dataType:"text",success:function(responseText,
status){data=responseText}});return data},JSON=function(data){return eval("("+data+")")};broke.extend(brokebroke.utils.translation.gettext,{init:function(args){domain="messages";url=args.url;if(url)tryLoadLangPo(url);else tryLoadLang()},gettext:gettext,ngettext:ngettext})})();
(function(){var gettext=brokebroke.utils.translation.gettext.gettext;broke.extend({urlResolvers:{patterns:function(prefix,urlPatterns){urlPatterns.map(function(){if(typeof this[1]==="string")this[1]=getattr(prefix+"."+this[1]);return this});return urlPatterns},include:function(urlObject){if(typeof urlObject==="string")return getattr(urlObject);return urlObject},parseQueryString:function(queryString){var result={};if(!queryString)return{};queryString=queryString.split("&");queryString.each(function(){var tmp=this.split("=");
result[tmp[0]]=tmp[1]});return result},resolve:function(url,args,urlPatterns){var view=null,match=null,i,_this;urlPatterns=urlPatterns||broke.urlPatterns;args=args||[];for(i=0;i<urlPatterns.length;i++){_this=urlPatterns[i];match=url.match(_this[0]);if(match){if(match.length>1)args=args.concat(match.slice(1));view=_this[1];if(typeof view==="string")view=getattr(view);if(typeof view==="function")return[view,args];else if(typeof view==="object"){url=url.replace(match[0],"");return broke.urlResolvers.resolve(url,
args,view)}}}throw broke.exceptions.NotFound(gettext("Matching url not found."));},reverse:function(namedUrl,args,urlPatterns,result){var match=null,i,isInclude,_this;urlPatterns=urlPatterns||broke.urlPatterns;result=result||"";args=args||[];for(i=0;i<urlPatterns.length;i++){_this=urlPatterns[i];isInclude=isArray(_this[1]);if(isInclude)match=namedUrl.startsWith(_this[2]);else match=namedUrl===_this[2];if(match)if(isInclude){namedUrl=namedUrl.replace(_this[2]+"-","");return broke.urlResolvers.reverse(namedUrl,
args,_this[1],_this[0])}else{result+=_this[0];result=args.echo(result.replace("^","").replace("$","").replace(/\(.*?\)/g,"%s"));if(result.match(_this[0]))return result;else return""}}broke.log(gettext("No matching named url found, fail silently..."));return null}}})})();
(function(){var gettext=brokebroke.utils.translation.gettext.gettext;broke.extend(window,{forEach:function(obj,fn){var key;for(key in obj)if(obj.hasOwnProperty(key))if(fn.call(obj[key],key)===false)return false},center:function(value,spaces){var spacesBefore,spacesAfter;spaces=spaces-value.length;if(!spaces)return value;spacesBefore=Math.ceil(spaces/2);spacesAfter=Math.floor(spaces/2);value=value.split();while(spacesBefore--)value.unshift(" ");while(spacesAfter--)value.push(" ");return value.join()},getattr:function(str,obj){obj=
obj||window;str=str.split(".");if(str.length>1){str.each(function(){obj=obj[this.concat()]});return obj}return obj[str[0]]},keys:function(){if("keys"in window)return keys;return function(object){var results=[];forEach(object,function(key){results.push(key)});return results}}(),typeOf:function(obj){if(typeof obj==="string")return"string";else if(typeof obj==="number"&&isNaN(obj))return"NaN";else if(typeof obj==="number")return"number";else if(obj instanceof Array)return"array";else if(obj instanceof
Function)return"function";else if(obj instanceof Date)return"date";else if(obj===null)return"null";else if(obj===undefined)return"undefined";return"object"},isFunction:function(obj){return typeOf(obj)==="function"},isObject:function(obj){return typeOf(obj)==="object"},isArray:function(obj){return typeOf(obj)==="array"},eq:function(first,second){var i,key;if(first===undefined||second===undefined)return false;else if(first===null||second===null)return false;else if(first==second)return true;if(isArray(first)&&
isArray(second)){if(first.length!==second.length)return false;i=first.length;while(i--)if(first[i]!==second[i])return false;return true}else if(isObject(first)&&isObject(second)){if(!this.eq(keys(first),keys(second)))return false;for(key in first)if(first.hasOwnProperty(key))if(!this.eq(first[key],second[key]))return false;return true}return false},clone:function(obj){var key,newObj={};for(key in obj){if(typeOf(obj[key])==="array")newObj[key]=obj[key].clone();else if(typeOf(obj[key])==="object")newObj[key]=
clone(obj[key]);newObj[key]=obj[key]}return newObj},storage:function(){var localStorageSetObject=function(key,value){this.setItem(key,JSON.stringify(value))},localStorageGetObject=function(key){return JSON.parse(this.getItem(key))},storage={};if("localStorage"in window){broke.extend(Storage.prototype,{setObject:localStorageSetObject,getObject:localStorageGetObject});return localStorage}return{key:function(key){throw{name:"NotImplemented",description:gettext("Sorry, this version of localStorage is a fake and does not support key() method.")};
},setItem:function(key,value){storage[key]=value;return this},getItem:function(key){return storage[key]},removeItem:function(key){delete storage[key];return this},setObject:localStorageSetObject,getObject:localStorageGetObject,clear:function(){storage={};return this}}}(),random:{random:Math.random,randrange:function(start,stop,step){}}});broke.extend(Array.prototype,{clone:function(){var newArray=[];for(var i in this)if(this.hasOwnProperty(i))newArray[i]=this[i];return newArray},populate:function(args){for(var i=
0;i<args.length;i++)this.push(args[i]);return this},each:function(callback,args){for(var i=0;i<this.length;i++)callback.call(this[i],args);return this},filter:function(callback,args){var array_tmp=this.constructor();for(var i=0;i<this.length;i++)if(callback.call(this[i],args))array_tmp.push(this[i]);return array_tmp},map:function(operation,args){for(var i=0;i<this.length;i++)this[i]=operation.call(this[i],args);return this},last:function(args){if(args){this[this.length-1]=args;return this}return this[this.length-
1]},echo:function(str){var tmp=str.split("%s");for(var i=0;i<tmp.length-1;i++)tmp[i]+=this.shift();return tmp.join("")},indexOf:function(obj){for(var i=0;i<this.length;i++)if(this[i]===obj)return i;return-1},remove:function(from,to){var _this=this;if(typeOf(from)==="array"){from.each(function(){_this.remove(_this.indexOf(this))});return _this}else{var rest=this.slice((to||from)+1||this.length);this.length=from<0?this.length+from:from;return this.push.apply(this,rest)}},has:function(obj){return this.indexOf(obj)>=
0}});broke.extend(String.prototype,{"in":function(array){var i;for(i=0;i<array.length;i++)if(this.concat()===array[i])return true;return false},startsWith:function(stringToMatch){return this.concat().match("^"+stringToMatch)===null?false:true},lower:function(){return this.toLowerCase()},upper:function(){return this.toUpperCase()},trim:function(){var str=this.replace(/^\s\s*/,""),ws=/\s/,i=str.length;while(ws.test(str.charAt(--i)));return str.slice(0,i+1)},asInt:function(){return parseInt(this,10)},
capitalize:function(){return this.replace(/\w+/g,function(a){return a[0].toUpperCase()+a.substr(1).toLowerCase()})},slugify:function(){return this.replace(/^\s+/gi,"").replace(/\s+$/gi,"").replace(/\s+/g,"-").replace(/'+/g,"-").toLowerCase()},rescape:function(){return this.replace(/(\(|\)|\{|\})/g,"\\$1")},bsplit:function(path){var cursor=0,result=[],_this=this;this.replace(path,function(m1,m2,n){result.push(_this.slice(cursor,n));result.push(m1);cursor=n+m1.length});return result},interpolate:function(){var cache=
{};return function(data){var fn=!/\W/.test(this)?(cache[this]=cache[this]||document.getElementById(this).innerHTML.interpolate()):new Function("obj","var p=[],print=function(){p.push.apply(p,arguments);};"+"with(obj){p.push('"+this.replace(/[\r\t\n]/g," ").split("\r").join("\\'").split("%(").join("\t").replace(/\t(.*?)\)s/g,"',$1,'").split("\t").join("');").split(")s").join("p.push('").split("\r").join("\\'")+"');"+"}"+"return p.join('');");return data?fn(data):fn}}(),render:function(){var cache=
{};return function(data){var fn=!/\W/.test(this)?(cache[this]=cache[this]||document.getElementById(this).innerHTML.render()):new Function("obj","var p=[],print=function(){p.push.apply(p,arguments);};"+"with(obj){p.push('"+this.replace(/[\r\t\n]/g," ").split("{%").join("\t").split("\t").join("');").split("%}").join("p.push('").split("\r").join("\\'").split("{{").join("\t").replace(/\t(.*?)\}\}/g,"',$1,'").split("\t").join("');").split("}}").join("p.push('").split("\r").join("\\'")+"');"+"}"+"return p.join('');");
return data?fn(data):fn}}(),echo:function(){return[].populate(arguments).echo(this)},contains:function(str){return this.indexOf(str)>=0}});broke.extend(Number.prototype,{asInt:function(){return parseInt(this,10)}});broke.extend(Date.prototype,{format:function(format){var formatLength=format.length,i,curChar,returnStr="",replace={shortMonths:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],longMonths:["January","February","March","April","May","June","July","August","September",
"October","November","December"],shortDays:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],longDays:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],d:function(){return(this.getDate()<10?"0":"")+this.getDate()},D:function(){return Date.replaceChars.shortDays[this.getDay()]},j:function(){return this.getDate()},l:function(){return Date.replaceChars.longDays[this.getDay()]},N:function(){return this.getDay()+1},S:function(){return this.getDate()%10==1&&this.getDate()!=11?"st":this.getDate()%
10===2&&this.getDate()!=12?"nd":this.getDate()%10==3&&this.getDate()!==13?"rd":"th"},w:function(){return this.getDay()},z:function(){return"Not Yet Supported"},W:function(){return"Not Yet Supported"},F:function(){return Date.replaceChars.longMonths[this.getMonth()]},m:function(){return(this.getMonth()<9?"0":"")+(this.getMonth()+1)},M:function(){return Date.replaceChars.shortMonths[this.getMonth()]},n:function(){return this.getMonth()+1},t:function(){return"Not Yet Supported"},L:function(){return this.getFullYear()%
4===0&&this.getFullYear()%100!==0||this.getFullYear()%400===0?"1":"0"},o:function(){return"Not Supported"},Y:function(){return this.getFullYear()},y:function(){return(""+this.getFullYear()).substr(2)},a:function(){return this.getHours()<12?"am":"pm"},A:function(){return this.getHours()<12?"AM":"PM"},B:function(){return"Not Yet Supported"},g:function(){return this.getHours()%12||12},G:function(){return this.getHours()},h:function(){return((this.getHours()%12||12)<10?"0":"")+(this.getHours()%12||12)},
H:function(){return(this.getHours()<10?"0":"")+this.getHours()},i:function(){return(this.getMinutes()<10?"0":"")+this.getMinutes()},s:function(){return(this.getSeconds()<10?"0":"")+this.getSeconds()},e:function(){return"Not Yet Supported"},I:function(){return"Not Supported"},O:function(){return(-this.getTimezoneOffset()<0?"-":"+")+(Math.abs(this.getTimezoneOffset()/60)<10?"0":"")+Math.abs(this.getTimezoneOffset()/60)+"00"},P:function(){return(-this.getTimezoneOffset()<0?"-":"+")+(Math.abs(this.getTimezoneOffset()/
60)<10?"0":"")+Math.abs(this.getTimezoneOffset()/60)+":"+(Math.abs(this.getTimezoneOffset()%60)<10?"0":"")+Math.abs(this.getTimezoneOffset()%60)},T:function(){var m=this.getMonth();this.setMonth(0);var result=this.toTimeString().replace(/^.+ \(?([^\)]+)\)?$/,"$1");this.setMonth(m);return result},Z:function(){return-this.getTimezoneOffset()*60},c:function(){return this.format("Y-m-d")+"T"+this.format("H:i:sP")},r:function(){return this.toString()},U:function(){return this.getTime()/1E3}};for(i=0;i<
formatLength;i++){curChar=format.charAt(i);if(curChar in replace)returnStr+=replace[curChar].call(this);else returnStr+=curChar}return returnStr}})})();
(function(){$(window).bind("broke.request",function(e,request){var response={},view=null,args=null,urlMatchResult=[],partialUrl,parseQueryString=broke.urlResolvers.parseQueryString,resolve=broke.urlResolvers.resolve;request=broke.extend({completeUrl:window.location.href,event:null,type:"get",fromReload:false},request);partialUrl=request.url.split("?");if(partialUrl.length>1){request.url=partialUrl[0];request.queryData=parseQueryString(partialUrl[1])}broke.settings.middleware.each(function(){var middleware=
getattr(this.concat());if(middleware.processRequest!==undefined)middleware.processRequest(request)});try{urlMatchResult=resolve(request.url)}catch(error){if(error.name==="NotFound"){getattr(broke.settings.handler404)(request);broke.response(response);return}else throw error;}if(urlMatchResult){view=urlMatchResult[0];args=urlMatchResult[1];response=view(request,args);response=broke.extend(request,response);$(window).trigger("broke.response",[response])}});$(window).bind("broke.response",function(e,
response){forEach(response.additionalProperties,function(key){response.element[key]=this});if(typeOf(response.callback)==="function")response.callback.apply(response.element);broke.settings.middleware.reverse().each(function(){var middleware=getattr(this);if(middleware.processResponse!==undefined)middleware.processResponse(response)})})})();
(function(){var gettext=brokebroke.utils.translation.gettext.gettext;broke.extend(window,{forEach:function(obj,fn){var key;for(key in obj)if(obj.hasOwnProperty(key))if(fn.call(obj[key],key)===false)return false},center:function(value,spaces){var spacesBefore,spacesAfter;spaces=spaces-value.length;if(!spaces)return value;spacesBefore=Math.ceil(spaces/2);spacesAfter=Math.floor(spaces/2);value=value.split();while(spacesBefore--)value.unshift(" ");while(spacesAfter--)value.push(" ");return value.join()},getattr:function(str,obj){obj=
obj||window;str=str.split(".");if(str.length>1){str.each(function(){obj=obj[this.concat()]});return obj}return obj[str[0]]},keys:function(){if("keys"in window)return keys;return function(object){var results=[];forEach(object,function(key){results.push(key)});return results}}(),typeOf:function(obj){if(typeof obj==="string")return"string";else if(typeof obj==="number"&&isNaN(obj))return"NaN";else if(typeof obj==="number")return"number";else if(obj instanceof Array)return"array";else if(obj instanceof
Function)return"function";else if(obj instanceof Date)return"date";else if(obj===null)return"null";else if(obj===undefined)return"undefined";return"object"},isFunction:function(obj){return typeOf(obj)==="function"},isObject:function(obj){return typeOf(obj)==="object"},isArray:function(obj){return typeOf(obj)==="array"},eq:function(first,second){var i,key;if(first===undefined||second===undefined)return false;else if(first===null||second===null)return false;else if(first==second)return true;if(isArray(first)&&
isArray(second)){if(first.length!==second.length)return false;i=first.length;while(i--)if(first[i]!==second[i])return false;return true}else if(isObject(first)&&isObject(second)){if(!this.eq(keys(first),keys(second)))return false;for(key in first)if(first.hasOwnProperty(key))if(!this.eq(first[key],second[key]))return false;return true}return false},clone:function(obj){var key,newObj={};for(key in obj){if(typeOf(obj[key])==="array")newObj[key]=obj[key].clone();else if(typeOf(obj[key])==="object")newObj[key]=
clone(obj[key]);newObj[key]=obj[key]}return newObj},storage:function(){var localStorageSetObject=function(key,value){this.setItem(key,JSON.stringify(value))},localStorageGetObject=function(key){return JSON.parse(this.getItem(key))},storage={};if("localStorage"in window){broke.extend(Storage.prototype,{setObject:localStorageSetObject,getObject:localStorageGetObject});return localStorage}return{key:function(key){throw{name:"NotImplemented",description:gettext("Sorry, this version of localStorage is a fake and does not support key() method.")};
},setItem:function(key,value){storage[key]=value;return this},getItem:function(key){return storage[key]},removeItem:function(key){delete storage[key];return this},setObject:localStorageSetObject,getObject:localStorageGetObject,clear:function(){storage={};return this}}}(),random:{random:Math.random,randrange:function(start,stop,step){}}});broke.extend(Array.prototype,{clone:function(){var newArray=[];for(var i in this)if(this.hasOwnProperty(i))newArray[i]=this[i];return newArray},populate:function(args){for(var i=
0;i<args.length;i++)this.push(args[i]);return this},each:function(callback,args){for(var i=0;i<this.length;i++)callback.call(this[i],args);return this},filter:function(callback,args){var array_tmp=this.constructor();for(var i=0;i<this.length;i++)if(callback.call(this[i],args))array_tmp.push(this[i]);return array_tmp},map:function(operation,args){for(var i=0;i<this.length;i++)this[i]=operation.call(this[i],args);return this},last:function(args){if(args){this[this.length-1]=args;return this}return this[this.length-
1]},echo:function(str){var tmp=str.split("%s");for(var i=0;i<tmp.length-1;i++)tmp[i]+=this.shift();return tmp.join("")},indexOf:function(obj){for(var i=0;i<this.length;i++)if(this[i]===obj)return i;return-1},remove:function(from,to){var _this=this;if(typeOf(from)==="array"){from.each(function(){_this.remove(_this.indexOf(this))});return _this}else{var rest=this.slice((to||from)+1||this.length);this.length=from<0?this.length+from:from;return this.push.apply(this,rest)}},has:function(obj){return this.indexOf(obj)>=
0}});broke.extend(String.prototype,{"in":function(array){var i;for(i=0;i<array.length;i++)if(this.concat()===array[i])return true;return false},startsWith:function(stringToMatch){return this.concat().match("^"+stringToMatch)===null?false:true},lower:function(){return this.toLowerCase()},upper:function(){return this.toUpperCase()},trim:function(){var str=this.replace(/^\s\s*/,""),ws=/\s/,i=str.length;while(ws.test(str.charAt(--i)));return str.slice(0,i+1)},asInt:function(){return parseInt(this,10)},
capitalize:function(){return this.replace(/\w+/g,function(a){return a[0].toUpperCase()+a.substr(1).toLowerCase()})},slugify:function(){return this.replace(/^\s+/gi,"").replace(/\s+$/gi,"").replace(/\s+/g,"-").replace(/'+/g,"-").toLowerCase()},rescape:function(){return this.replace(/(\(|\)|\{|\})/g,"\\$1")},bsplit:function(path){var cursor=0,result=[],_this=this;this.replace(path,function(m1,m2,n){result.push(_this.slice(cursor,n));result.push(m1);cursor=n+m1.length});return result},interpolate:function(){var cache=
{};return function(data){var fn=!/\W/.test(this)?(cache[this]=cache[this]||document.getElementById(this).innerHTML.interpolate()):new Function("obj","var p=[],print=function(){p.push.apply(p,arguments);};"+"with(obj){p.push('"+this.replace(/[\r\t\n]/g," ").split("\r").join("\\'").split("%(").join("\t").replace(/\t(.*?)\)s/g,"',$1,'").split("\t").join("');").split(")s").join("p.push('").split("\r").join("\\'")+"');"+"}"+"return p.join('');");return data?fn(data):fn}}(),render:function(){var cache=
{};return function(data){var fn=!/\W/.test(this)?(cache[this]=cache[this]||document.getElementById(this).innerHTML.render()):new Function("obj","var p=[],print=function(){p.push.apply(p,arguments);};"+"with(obj){p.push('"+this.replace(/[\r\t\n]/g," ").split("{%").join("\t").split("\t").join("');").split("%}").join("p.push('").split("\r").join("\\'").split("{{").join("\t").replace(/\t(.*?)\}\}/g,"',$1,'").split("\t").join("');").split("}}").join("p.push('").split("\r").join("\\'")+"');"+"}"+"return p.join('');");
return data?fn(data):fn}}(),echo:function(){return[].populate(arguments).echo(this)},contains:function(str){return this.indexOf(str)>=0}});broke.extend(Number.prototype,{asInt:function(){return parseInt(this,10)}});broke.extend(Date.prototype,{format:function(format){var formatLength=format.length,i,curChar,returnStr="",replace={shortMonths:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],longMonths:["January","February","March","April","May","June","July","August","September",
"October","November","December"],shortDays:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],longDays:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],d:function(){return(this.getDate()<10?"0":"")+this.getDate()},D:function(){return Date.replaceChars.shortDays[this.getDay()]},j:function(){return this.getDate()},l:function(){return Date.replaceChars.longDays[this.getDay()]},N:function(){return this.getDay()+1},S:function(){return this.getDate()%10==1&&this.getDate()!=11?"st":this.getDate()%
10===2&&this.getDate()!=12?"nd":this.getDate()%10==3&&this.getDate()!==13?"rd":"th"},w:function(){return this.getDay()},z:function(){return"Not Yet Supported"},W:function(){return"Not Yet Supported"},F:function(){return Date.replaceChars.longMonths[this.getMonth()]},m:function(){return(this.getMonth()<9?"0":"")+(this.getMonth()+1)},M:function(){return Date.replaceChars.shortMonths[this.getMonth()]},n:function(){return this.getMonth()+1},t:function(){return"Not Yet Supported"},L:function(){return this.getFullYear()%
4===0&&this.getFullYear()%100!==0||this.getFullYear()%400===0?"1":"0"},o:function(){return"Not Supported"},Y:function(){return this.getFullYear()},y:function(){return(""+this.getFullYear()).substr(2)},a:function(){return this.getHours()<12?"am":"pm"},A:function(){return this.getHours()<12?"AM":"PM"},B:function(){return"Not Yet Supported"},g:function(){return this.getHours()%12||12},G:function(){return this.getHours()},h:function(){return((this.getHours()%12||12)<10?"0":"")+(this.getHours()%12||12)},
H:function(){return(this.getHours()<10?"0":"")+this.getHours()},i:function(){return(this.getMinutes()<10?"0":"")+this.getMinutes()},s:function(){return(this.getSeconds()<10?"0":"")+this.getSeconds()},e:function(){return"Not Yet Supported"},I:function(){return"Not Supported"},O:function(){return(-this.getTimezoneOffset()<0?"-":"+")+(Math.abs(this.getTimezoneOffset()/60)<10?"0":"")+Math.abs(this.getTimezoneOffset()/60)+"00"},P:function(){return(-this.getTimezoneOffset()<0?"-":"+")+(Math.abs(this.getTimezoneOffset()/
60)<10?"0":"")+Math.abs(this.getTimezoneOffset()/60)+":"+(Math.abs(this.getTimezoneOffset()%60)<10?"0":"")+Math.abs(this.getTimezoneOffset()%60)},T:function(){var m=this.getMonth();this.setMonth(0);var result=this.toTimeString().replace(/^.+ \(?([^\)]+)\)?$/,"$1");this.setMonth(m);return result},Z:function(){return-this.getTimezoneOffset()*60},c:function(){return this.format("Y-m-d")+"T"+this.format("H:i:sP")},r:function(){return this.toString()},U:function(){return this.getTime()/1E3}};for(i=0;i<
formatLength;i++){curChar=format.charAt(i);if(curChar in replace)returnStr+=replace[curChar].call(this);else returnStr+=curChar}return returnStr}})})();broke.extend({contextProcessors:{debug:function(request){return{debug:broke.settings.debug}},i18n:function(request){return{languageCode:broke.settings.languageCode,languages:keys(broke.settings.languages)}}}});
(function(){var gettext=brokebroke.utils.translation.gettext.gettext;broke.Class.extend("broke.db.models.Query",{exclude:function(args){return this.filter(args,false)},create:function(args){this.storage.push(args);return(new this.model(args)).save()},getOrCreate:function(args){try{return this.get(args)}catch(e){if(e.name==="DoesNotExist")return this.create(args);throw e;}},get:function(args){var object=null;if(args)object=this.filter(args).asObject();else object=this.asObject();if(object.length>1)throw this.model.MultipleObjectsReturned(gettext("get() returned few %s instances -- it returned %s! Lookup parameters were %s").echo(this.model.className,
object.length,args));if(!object.length)throw this.model.DoesNotExist(gettext("%s matching query does not exist.").echo(this.model.className));return object[0]},latest:function(field){var filterArgs={},args=field||broke.settings.getLatestBy||"id",max;field="";this.data.each(function(){if(field<this[args])max=this[args]});filterArgs[field]=max;return this.filter(filterArgs).all()[0]},all:function(){return this.asObject()}});broke.db.models.Query.extend("broke.db.models.LocalQuery",{init:function(model,
data){this.model=model;if(!(this.model.tableName in broke.storage))broke.storage[this.model.tableName]=[];this.storage=broke.storage[this.model.tableName];this.data=data||this.storage.clone()||[]},filterOperations:{contains:function(first,second){if(first.match(second))return true;return false},iContains:function(first,second){return this.contains(first.lower(),second.lower())},startsWith:function(first,second){if(first.match("^"+second))return true;return false},iStartsWith:function(first,second){return this.startsWith(first.lower(),
second.lower())},endsWith:function(first,second){if(first.match(second+"$"))return true;return false},iEndsWith:function(first,second){return this.EndsWith(first.lower(),second.lower())},exact:function(first,second){if(first.match("^"+second+"$"))return true;return false},iExact:function(first,second){return this.exact(first.lower(),second.lower())},"in":function(first,second){return second.has(first)},gt:function(first,second){return first>second},gte:function(first,second){return first>=second},
lt:function(first,second){return first<second},lte:function(first,second){return first<=second},regex:function(first,second){return first.match(second)},iRegex:function(first,second){return this.regex(first.lower(),second.lower())},isNull:function(first,second){return first===null||first===undefined?second:!second},year:function(first,second){return(new Date(first)).getFullYear()===second},month:function(first,second){return(new Date(first)).getMonth()+1===second},day:function(first,second){return(new Date(first)).getDate()===
second},weekDay:function(first,second){return(new Date(first)).getDay()===second},range:function(first,second){return second[0]<=first&&first<=second[1]}},filter:function(args,negate){if(negate===undefined)negate=true;var _this=this,newData=this.data.filter(function(){var splitData=null,filterOperation=null,key=null,newKey=null;for(key in args)if(args.hasOwnProperty(key)){splitData=key.split("__");if(splitData.length>1){newKey=splitData[0];filterOperation=splitData[1];if(filterOperation in _this.filterOperations){if(!_this.filterOperations[filterOperation](this.fields[newKey],
args[key]))return!negate}else throw broke.exceptions.NotImplemented(gettext("Filter operation %s not implemented.").echo(filterOperation));}else if(this[key]!==args[key])return!negate}return negate});return new this.Class(this.model,newData)},asObject:function(){var _this=this;this.data.map(function(){return new _this.model(this)});return this.data},"delete":function(){this.all().each(function(){this["delete"]()});return null}});broke.db.models.Query.extend("broke.db.models.RemoteQuery",{init:function(model,
newQueryArgs){this.model=model;this.storage=[];this.queryArgs=newQueryArgs||{};this.data=[]},filter:function(args,negate){if(negate===undefined)negate=true;args=broke.extend(this.queryArgs,args);return new this.Class(this.model,args)},asObject:function(){var _this=this,url=broke.settings.jsonUrls.getData.interpolate({appLabel:_this.model.appLabel,model:_this.model.className.lower()}),status;$.ajax({async:false,type:"GET",url:url,data:this.queryArgs,dataType:broke.settings.ajax.dataType,error:function(xhr,
textStatus,errorThrown){status=textStatus},success:function(data,textStatus){status=textStatus;_this.data=data}});this.data.map(function(){return new _this.model(this)});return this.data}});broke.Class.extend("broke.db.models.Manager",{init:function(model){this.model=model;this.queryClass={local:broke.db.models.LocalQuery,remote:broke.db.models.RemoteQuery}[broke.settings.queryType]},all:function(){return this.getQuerySet().all()},create:function(args){return this.getQuerySet().create(args)},exclude:function(args){return this.getQuerySet().exclude(args)},
filter:function(args){return this.getQuerySet().filter(args)},get:function(args){return this.getQuerySet().get(args)},getOrCreate:function(args){return this.getQuerySet().getOrCreate(args)},getQuerySet:function(){return new this.queryClass(this.model)},latest:function(args){return this.getQuerySet().latest(args)}});broke.Class.extend("broke.db.models.Model",{init:function(){this.objects=new broke.db.models.Manager(this);this.baseUrl="/%s/%s/json/".echo(this.app_label,this.className.lower());this.MultipleObjectsReturned=
broke.exceptions.MultipleObjectsReturned;this.DoesNotExist=broke.exceptions.DoesNotExist},autoInit:false,elements:function(args){var elementIdentifier=this.className.lower(),elements=$('[rel~="'+elementIdentifier+'"]');if(args)elements=elements.filter(args);return elements}},{init:function(args,inheritedFields){broke.extend(this,args||{});if(this.fields.pk===undefined)this.fields.pk=this.pk;this.dbReference=args},getSlug:function(field){return(field||this.fields.title||"").slugify()},elements:function(args){var elementIdentifier=
this.Class.className.lower()+"_"+this.pk,elements=$('[rel~="'+elementIdentifier+'"]');if(args)elements=elements.filter(args);return elements},getForm:function(){if(!this.form){var form=this.elements("form");if(form.length)this.form=form;else{this.form=$('<form enctype="multipart/form-data" action="." method="post" style="display:none;" class="PSIXForm">');$("body").append(this.form)}}return this.form},getAbsoluteUrl:function(){return""},getOperation:function(del){if(del!==undefined&&this.fields.pk)return"delete";
else if(this.fields.pk)return"update";return"create"},save:function(saveSettings){saveSettings=saveSettings||{};var _this=this,className=_this.Class.className.lower(),operation=saveSettings.operation?"delete":"save",operationUrl=broke.settings.jsonUrls[operation].interpolate({model:className,appLabel:_this.Class.appLabel});$(window).trigger("broke."+className+".pre_"+operation,[this]);saveSettings=broke.extend(clone(broke.settings.save),saveSettings);if(saveSettings.commit)if(broke.settings.useAjax)$.ajax({async:broke.settings.ajax.async,
type:"POST",url:operationUrl,data:_this.fields,dataType:broke.settings.ajax.dataType,error:function(xhr,status,error){status=status},success:function(data,status){if(saveSettings["delete"]){status=status;return}_this.pk=data.pk;_this.model=data.model;_this.fields.id=_this.pk;broke.extend(_this.dbReference,{pk:_this.pk,model:_this.model,fields:_this.fields});status=status},complete:function(){$(window).trigger("broke."+className+".post_"+operation,[this])}});else{var form=this.getForm();forEach(_this.fields,
function(key){form.append($('<input type="hidden" name="'+key+'" value="'+this+'"/>'))});form.submit();$(window).trigger("broke."+className+".post_"+operation,[this])}else broke.extend(this.dbReference,{pk:this.pk,model:this.model,fields:this.fields});return _this},"delete":function(settings){settings=settings||{};settings.operation="delete";return this.save(settings)}})})();(function(){var gettext=brokebroke.utils.translation.gettext.gettext;broke.Class.extend("broke.db.fields.Field",{init:function(){}},{init:function(){}})});
(function(){var template=broke.template;broke.extend(template,{TOKEN_TEXT:0,TOKEN_VAR:1,TOKEN_BLOCK:2,TOKEN_COMMENT:3,FILTER_SEPARATOR:"|",FILTER_ARGUMENT_SEPARATOR:":",VARIABLE_ATTRIBUTE_SEPARATOR:".",BLOCK_TAG_START:"{%",BLOCK_TAG_END:"%}",VARIABLE_TAG_START:"{{",VARIABLE_TAG_END:"}}",COMMENT_BLOCK_TAG_START:"{#",COMMENT_TAG_END:"#}",SINGLE_BRACE_START:"{",SINGLE_BRACE_END:"}",tagList:{},filterList:{},register:{tag:function(tagName,fn){broke.template.tagList[tagName]=fn},filter:function(filterName,
fn){broke.template.filterList[filterName]=fn}}});broke.Class.extend("broke.template.Template",{listRender:function(context,nodelist){var result=[];nodelist.each(function(){result.push(this.render(context))});return result.join("")},getVar:function(context,varstr){return getattr(varstr,context)}},{init:function(tpl){this._nodelist=this._compile(tpl)},_compile:function(tpl){var tokens,tagStr=this._formRegx(),tagRe=new RegExp(tagStr,"g"),bits=tpl.bsplit(tagRe);bits=bits.filter(function(){return this!==
""});tokens=bits.map(function(){var tagToken;if(this.startsWith(template.BLOCK_TAG_START)){tagToken=this.slice(template.BLOCK_TAG_START.length,-template.BLOCK_TAG_END.length);return new template.Token(template.TAG_TOKEN,tagToken)}else if(this.startsWith(template.VARIABLE_TAG_START))return new template.Token(template.TOKEN_VAR,this.slice(template.VARIABLE_TAG_START.length,-template.VARIABLE_TAG_END.length));else return new template.Token(template.TOKEN_TEXT,this)});return(new template.Parser(tokens)).parse()},
_formRegx:function(){var ret="";ret+="("+template.BLOCK_TAG_START.rescape()+".*?"+template.BLOCK_TAG_END.rescape()+"|"+template.VARIABLE_TAG_START.rescape()+".*?"+template.VARIABLE_TAG_END.rescape()+"|$"+")";return ret},render:function(context){var result=[];this._nodelist.each(function(){if(typeof this==="object")typeof this.render==="function"?result.push(this.render(context)):result.push(this.toString());else result.push(this.toString())});return result.join("")}});broke.Class.extend("broke.template.Token",
{init:function(type,content){this.type=type;if(this.type!==template.TOKEN_TEXT)content=content.replace(/^\s+|\s+$/g,"");this.content=content},tsplit:function(){}})})();
(function(){var tpl=broke.template,Template=tpl.Template,TemplateSyntaxError=broke.exceptions.TemplateSyntaxError;broke.Class.extend("broke.template.VarNode",{init:function(varstr){var args=varstr.split(tpl.FILTER_SEPARATOR);this.varstr=args[0];this.filters=args.slice(1);this.content=null},applyFilters:function(){var _this=this;this.filters.each(function(){var args=this.split(tpl.FILTER_ARGUMENT_SEPARATOR)[1]||null;if(!(this in tpl.filterList)){broke.log("Filter not found, fail silently...");return}_this.content=
tpl.filterList[this](_this.content,args)});return this},render:function(context){this.content=getattr(this.varstr,context);if(this.filters)this.applyFilters();return this.content}});broke.Class.extend("broke.template.TextNode",{init:function(str){this.str=str},render:function(){return this.str}});broke.Class.extend("broke.template.CommentNode",{init:function(str){this.str=str},render:function(context){return""}});broke.Class.extend("broke.template.IfNode",{_and:0,_or:1},{init:function(linkType,boolPairs,
nodeListTrue,nodeListFalse){this.linkType=linkType;this.boolPairs=boolPairs;this.nodeListTrue=nodeListTrue;this.nodeListFalse=nodeListFalse},render:function(context){var flag;if(this.linkType==this.Class._and){flag=true;if(this.mapBoolpair(false,context))flag=false}else{flag=false;if(this.mapBoolpair(true,context))flag=true}return flag?Template.listRender(context,this.nodeListTrue):Template.listRender(context,this.nodeListFalse)},mapBoolpair:function(tc,context){var tmpbp="",bp=this.boolPairs,i,ilen;
for(i=0,ilen=bp.length;i<ilen;i++){tmpbp=bp[i].split(" ");if(tmpbp.length==2&&tmpbp[0]=="not"){if(tc!=Template.getVar(context,tmpbp[1]))return true}else if(tc==Template.getVar(context,tmpbp[0]))return true}return false}});broke.Class.extend("broke.template.ForNode",{init:function(loopvar,sequence,reversed,nodeListLoop){this.loopvar=loopvar;this.sequence=sequence.split(".");this.reversed=reversed;this.nodeListLoop=nodeListLoop},render:function(context){var ret=[],parentloop,items=context,k,i,klen,
ilen;if(context.forloop)parentloop=context.forloop;for(k=0,klen=this.sequence.length;k<klen;k++)items=items[this.sequence[k]];if(!(items instanceof Array))throw TemplateSyntaxError(gettext("values is not a array"));if(this.reversed)items=items.reverse();for(i=0,ilen=items.length;i<ilen;i++){context.forloop={counter0:i,counter:i+1,revcounter:ilen-i,revcounter0:ilen-i-1,first:i===0,last:i===ilen-1,parentloop:parentloop};context[this.loopvar]=items[i];ret.push(Template.listRender(context,this.nodeListLoop))}context.forloop=
undefined;return ret.join("")}})})();
(function(){var tpl=broke.template,gettext=brokebroke.utils.translation.gettext.gettext,TemplateSyntaxError=broke.exceptions.TemplateSyntaxError;broke.Class.extend("broke.template.Parser",{init:function(tokens){this.tokens=tokens},parse:function(parseUntil){var nodelist=[],token=null,tagFuncName=null,tagFunc=null;if(!parseUntil)parseUntil=[];if(!(parseUntil instanceof Array))parseUntil=[parseUntil];while(this.tokens.length){token=this.tokens.shift();if(token.type===tpl.TOKEN_TEXT)nodelist.push(new tpl.TextNode(token.content));else if(token.type===
tpl.TOKEN_VAR)nodelist.push(new tpl.VarNode(token.content));else if(token.type===tpl.TOKEN_BLOCK){if(parseUntil.has(token.content)){this.prependToken(token);return nodelist}tagFuncName=token.content.split(/\s+/)[0];if(!tagFuncName)throw TemplateSyntaxError(gettext("Empty Tag"));tagFunc=tpl.tag[tagFuncName];if(!tagFunc)throw TemplateSyntaxError(gettext("Unknow Tag"));nodelist.push(tagFunc(this,token))}}return nodelist},skipPast:function(endtag){var token=null;while(this.tokens.length){token=this.tokens.shift();
if(token.type===tpl.TOKEN_BLOCK&&token.content===endtag)return}throw TemplateSyntaxError(gettext("Not Closed Tag"));},prependToken:function(token){this.tokens.unshift(token)},nextToken:function(){return this.tokens.shift()},deleteFirstToken:function(){this.tokens.shift();return true}})})();
(function(){var tpl=broke.template,register=tpl.register,TemplateSyntaxError=broke.exceptions.TemplateSyntaxError,gettext=brokebroke.utils.translation.gettext.gettext;register.tag("if",function(parser,token){var bits=token.content.split(/\s+/),linkType,nodeListTrue,nodeListFalse;bits.shift();if(!bits)throw TemplateSyntaxError(gettext("If node need at least one args"));var bitstr=bits.join(" "),boolPairs=bitstr.split(" or ");if(boolPairs.length==1){linkType=tpl.IfNode._and;boolPairs=bitstr.split(" and ")}else{linkType=tpl.IfNode._or;
if(bitstr.indexOf(" and ")!==-1)throw TemplateSyntaxError(gettext('If node do not alow mix "and" & "or"'));}nodeListTrue=parser.parse(["else","endif"]);token=parser.nextToken();if(token.content.indexOf("else")!==-1){nodeListFalse=parser.parse("endif");parser.deleteFirstToken()}else nodeListFalse=[];return new tpl.IfNode(linkType,boolPairs,nodeListTrue,nodeListFalse)});register.tag("comment",function(parser,token){parser.skipPast("endcomment");return new tpl.CommentNode});register.tag("for",function(parser,
token){var bits=token.content.split(/\s+/),loopvar=bits[1],sequence=bits[3],reversed=bits.length===5,nodeListLoop=parser.parse("endfor");if(bits.length==5&&bits[4]!="reversed")throw TemplateSyntaxError(gettext("The 4 args of for tag must be reversed"));if(![4,5].has(bits.length))throw TemplateSyntaxError(gettext("The for tag should have 4 or 5 args"));if(bits[2]!="in")throw TemplateSyntaxError(gettext('The 2nd args of for tag must be "in"'));parser.deleteFirstToken();return new tpl.ForNode(loopvar,
sequence,reversed,nodeListLoop)})})();
(function(){var ngettext=brokebroke.utils.translation.gettext.ngettext,gettext=brokebroke.utils.translation.gettext.gettext,defaultFilters={add:function(value){return value.asInt()+value.asInt()},addslashes:function(value){return value.replace("\\","\\\\").replace('"','\\"').replace("'","\\'")},capfirst:function(value){return value[0].upper()+value.slice(1).lower()},center:function(value,args){return center(value,args.asInt())},cut:function(value,args){return value.replace(args,"")},date:function(value,args){if(typeOf(value)!=="date")value=new Date(value);
return value.format(args)},"default":function(value,args){return value===""?args:value},default_if_null:function(value,args){return value===null?args:value},dictsort:function(value){return value},dictsortreversed:function(value){return value},divisibleby:function(value,args){return value.asInt()&&args.asInt()},escape:function(value){var baseEscapes=[["<","&lt;"],[">","&gt;"],["'","&#39;"],['"',"&quot;"],["&","&amp;"]];baseEscapes.each(function(){var bad=this[0],good=this[1];value.replace(bad,good)});
return value},escapejs:function(value){var baseJsEscapes=[["\\","\\"],["'","'"],['"','"'],[">",">"],["<","<"],["&","&"],["=","="],["-","-"],[";",";"],["\u2028","\u2028"],["\u2029","\u2029"]];baseJsEscapes.each(function(){var bad=this[0],good=this[1];value.replace(bad,good)});return value},filesizeformat:function(bytes){var KB=1024,MB=KB*1024,GB=MB*1024;bytes=bytes.asInt();if(bytes<KB)return ngettext("%(size)d byte","%(size)d bytes",bytes).interpolate({size:bytes});if(bytes<MB)return gettext("%s KB").echo(bytes/
KB);if(bytes<GB)return gettext("%s MB").echo(bytes/MB);return gettext("%s GB").echo(bytes/GB)},first:function(list){return list[0]},fix_ampersands:function(value){return value.replace("&","&amp;")},floatformat:function(value,args){value=value.split(".");args=value[1][args];return value[0]+args},force_escape:function(value){return this.escape(value)},get_digit:function(value){var start=value*-1,end=start+1;return value.slice(start,end)},iriencode:function(value){return value},join:function(list,args){return list.join(args)},
last:function(value){return value.last()},length:function(value){return value.length},length_is:function(value,args){return value.length===args.asInt()},linebreaks:function(value){return value},linebreaksbr:function(value){return value.replace(/\n/g,"<br/>")},linenumbers:function(value){var numLines,i,result=[];value=value.split("\n");numLines=value.length;for(i=0;i<numLines;i++)result.push(i+1+". "+value[i]);return result.join("")},ljust:function(value,spaces){spaces=spaces.asInt()-value.length;
if(spaces){value=value.split("");while(spaces--)value.push(" ")}return value.join("")},lower:function(value){return value.lower()},make_list:function(value){if(typeOf(value)==="number"){value=new String(value);return value.split("").map(function(){return this.asInt()})}return value.split("")},phone2numeric:function(value){return value},pluralize:function(value,suffix){var suffixes=suffix.split(","),singularSuffix,pluralSuffix;if(suffixes.length>1){singularSuffix=suffixes[0];pluralSuffix=suffixes[1]}else{pluralSuffix=
suffixes[0];singularSuffix=""}if(value.length>1)return pluralSuffix;return singularSuffix},pprint:function(value){return value},random:function(list){return list},removetags:function(value,tags){tags.split(" ").each(function(){value.replace("<"+this+">","").replace("</"+this+">","")});return value},rjust:function(value,spaces){spaces=spaces.asInt()-value.length;if(spaces)while(spaces--)value+=" ";return value},safe:function(value){return value},safeseq:function(list){var _this=this;list.map(function(){return _this.save(this)});
return list},slice:function(list,args){args=args.split(",");if(args.length>1)return list.slice(args[0].asInt(),args[1].asInt());return list.slice(args[0].asInt())},slugify:function(value){return value.slugify()},stringformat:function(value,args){return value},striptags:function(value){return value.replace(/<[a-zA-Z_]>/g,"").replace(/<\/[a-zA-Z_]>/g,"")},time:function(value){return value},timesince:function(value){return value},timeuntil:function(value){return value},title:function(value){return value.capitalize()},
truncatewords:function(value,numberOfWords){return value.split(" ").slice(0,numberOfWords).join("")+"..."},truncatewords_html:function(value){return value},unordered_list:function(list){var createUl=function(list){var newUl=[];list.each(function(){if(typeOf(this)==="array"){newUl.push("<ul>");newUl.push(createUl(this));newUl.push("</ul>")}newUl.push("<li>");newUl.push(this);newUl.push("</li>")});return newUl.join("")};return createUl(list)},upper:function(value){return value.upper()},urlencode:function(value){return value},
urlize:function(value){return value},urlizetrunc:function(value){return value},wordcount:function(value){return value.split(" ").length},wordwrap:function(value,args){return value},yesno:function(value,args){args=args.split(",");var yes=args[0],no=args[1],maybe=args[2]||no;if(value===null)return maybe;else if(value)return yes;return no}};broke.extend(broke.template,{defaultFilters:defaultFilters});broke.extend(broke.template,{filterList:defaultFilters})})();
(function(){var applyContextProcessors=function(response){broke.settings.contextProcessors.each(function(){var contextProcessor=getattr(this);broke.extend(response.context,contextProcessor(response))});return response.context},renderToString=broke.template.loader.renderToString;broke.extend(broke.shortcuts,{node:{create:function(response){var allowedMethods=["after","before","append","prepend","wrap"],context=applyContextProcessors(response),renderedTemplate=renderToString(response.template,context),
newElement=$(renderedTemplate);response=broke.extend({method:"append",htmlNode:"body"},response);if(!allowedMethods.has(response.method))throw broke.exceptions.NotImplemented(gettext("The selected template's method (%s) is not implemented. Options are: after, before, append, prepend, wrap").echo(response.method));$(response.htmlNode)[response.method](newElement);response.element=newElement;return response},replace:function(response){var context=applyContextProcessors(response),renderedTemplate=renderToString(response.template,
context),newElement=$(renderedTemplate);$(response.htmlNode).replaceWith(newElement);response.element=newElement;return response},update:function(response){var acceptedAttributes=["class","rel"],searchFor;response=broke.extend({attribute:"rel",childrenOnly:true},response);searchFor=response.childrenOnly?"> *":"*";if(!acceptedAttributes.has(response.attribute))throw broke.exceptions.NotImplemented(gettext("You can not use %s's attribute. Options are: class, rel").echo(response.attribute));$(response.htmlNode).find(searchFor).each(function(){var _this=
$(this),key;for(key in response.object.fields)if(response.object.fields.hasOwnProperty(key)&&_this.attr(response.attribute)!==undefined)if(_this.attr(response.attribute).contains(key))_this.html(response.object.fields[key])});$(response.htmlNode).replaceWith(newElement);response.element=response.htmlNode;return true}}})})();broke.extend(broke.settings.locale,{en:{dateFormat:"MM-dd-yyyy",dateTimeFormat:"MM-dd-yyyy HH:MM"},it:{dateFormat:"dd-MM-yyyy",dateTimeFormat:"dd-MM-yyyy HH:MM"}}[broke.settings.language]);
(function(){broke.extend(broke.middleware,{CommonMiddleware:{processResponse:function(request){if(broke.settings.hideHash||broke.settings.preventDefault)request.event.preventDefault();if(broke.settings.stopPropagation)request.event.stopPropagation();return this}},AddressBarMiddleware:{processRequest:function(request){if(broke.settings.debug){var addressBar=$("#address_bar");if(!addressBar.length){addressBar=$(broke.templates.addressBar).appendTo($("body"));addressBar.find("a").click(function(e){e.preventDefault();
addressBar.slideUp()});addressBar.find("form").submit(function(e){e.preventDefault();broke.request({url:$(this).find("input").val(),event:e})})}addressBar.find("input").val(request.url);if(broke.settings.addressBar.hide===true)addressBar.slideDown(500,function(){setTimeout(function(){addressBar.slideUp()},2E3)});else if(addressBar.is(":hidden"))addressBar.slideDown(1200)}return this}}})})();
broke.extend(broke.templates,{addressBar:'<div id="address_bar" style="position:fixed;'+"top:-10px;"+"right:20px;"+"border:1px solid red;"+"border-top:0;"+"padding:20px;"+"background:#ff7209;"+"display:none;"+"z-index:999;"+"-moz-border-radius:10px;>"+'<a href="#" style="position:absolute;top:10px;right:20px;">[Hide]</a>'+'<form action="." method="post" style="padding:0;">'+"<p>"+'<label for="url">Url: </label>'+'<input type="text" name="url" size="60" value=""/>'+"</p>"+"</form>"+"</div>"});
(function(){broke.views={pageNotFound:function(request){broke.log(gettext("No matching url found, fail silently..."))}}})();
